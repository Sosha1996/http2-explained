# ۳. کارهایی که برای حل مشکل تأخیر انجام شد

مانند همیشه، هنگامی که با مشکلات مواجه می‌شویم، مردم گرد هم می‌آیند تا راه حلی را برای مشکلات بیابند. بعضی از این راه‌حل‌ها هوشمندانه و کاربردی هستند، برخی دیگر تنها موانعی مزخرف هستند.

## ۳.۱ Spriting
<img style="float: right;" src="https://raw.githubusercontent.com/bagder/http2-explained/master/images/spriting.jpg" />

Spriting اصطلاحاُ به کاری اطلاق می‌شود که تعداد زیادی تصاویر کوچک را در کنار هم قرار می‌دهیم تا یک تصویر بزرگ را تشکیل دهد. سپس از CSS یا JavaScript برای «برش‌دادن» آن‌ها استفاده می‌کنیم.

البته، این روش معایب خودش را هم دارد، برای مثال وب‌سایتی که می‌خواهد ۱ تا ۲تا از این تصاویر کوچک را نشان دهد، باید کل تصویر بزرگ را دانلود کند. همچنین باعث می‌شود که کل تصاویر به حافظه‌ی کش منتقل شوند، به‌جای این که تنها تصاویری که کاربرد دارند به کش منتقل شوند.

## ۳.۲ Inlining

Inlining یک کلک دیگر برای جلوگیری از ارسال تصاویر تکی است که با جانشین‌کردن داده‌های تصویر در URL صورت می‌پذیرد. مزایا و معایب این روش، شبیه Spriting است.

    .icon1 {
        background: url(data:image/png;base64,<data>) no-repeat;
    }

    .icon2 {
        background: url(data:image/png;base64,<data>) no-repeat;
    }

## ۳.۳ Concatenation

یک وب‌سایت بزرگ، ممکن است با فایل‌های JavaScript بسیاری همراه شود. ابزارهای Front-end به توسعه‌دهندگان کمک می‌کند که این فایل‌ها را در قالب یک فایل بزرگ‌تر قرار دهند تا مرورگر وب به جای چندین فایل کوچک، یک فایل بزرگ دانلود کند. داده‌های بسیار، تنها هنگامی ارسال می‌شوند که واقعا نیازی در کار باشد. اگر حتی یک خط از این کدها تغییر کنند، کل کدها باید مجددا بارگذاری شوند.

این روش، البته روش نامناسبی برای توسعه‌دهندگان پروژه است.

## ۳.۴ Sharding

آخرین کلک برای افزایش کارایی که اینجا اشاره می‌کنم، معمولا با نام Sharding شناخته می‌شود. این کلک به سادگی بیان می‌کند که جنبه‌های مختلف سرویس را در تعداد بسیار زیادی هوست (Host) تا جایی که ممکن است میزبانی کنید. در نگاه اول ممکن است عجیب به‌نظر بیاید، ولی یک دلیل قانع‌کننده پشت آن است.

در مقدمه، استاندارد HTTP 1.1 به کلاینت‌ها، اجازه‌ی برقراری بیش از ۲ اتصال TCP را به ازای هر میزبان نمی‌داد. بنابراین، برای زیرپا نگذاشتن این استاندارد، وب‌سایت‌های هوشمند به سادگی از host nameهای متفاوت برای هر تعداد از فایل‌ها استفاده کردند - و voilà! - حالا شما می‌توانید تعداد بیشتری اتصال به وب‌سایت برقرار کنید و در نتیجه سرعت بارگذاری هم افزایش پیدا می‌کند.

به مرور زمان، این محدودیت برداشته شد و کلاینت‌های امروز از ۶ الی ۸ اتصال به هر host name استفاده می‌کنند، ولی همچنان در تعداد اتصال‌ها محدودیت دارند، بنابراین وب‌سایت‌ها به استفاده از این روش ادامه می‌دهند. هنگامی که تعداد فایل‌های منابع بیشتر می شود، تعداد بیشتر اتصال برای اطمینان از عملکرد بهینه‌ی HTTP ایجاد می‌شود و وب‌سایت را سریع‌تر می‌کند. این برای وب‌سایت‌ها غیرعادی نیست که بیش از ۵۰ یا حتی ۱۰۰ اتصال برقرار کنند. آمارهای اخیر از httparchive.org نشان می‌دهند که ۳۰۰ هزار URL پرطرفدار در جهان به طور میانگین ۴۰ اتصال TCP برای نمایش وب‌سایت نیاز دارند، و این آمار نشان می‌دهد که این تعداد به آرامی در حال افزایش است.

دلیل دیگری که تصاویر و منابع مشابه را در host nameهای جداگانه قرار می‌دهند این است که آن‌ها از cookieها استفاده نمی‌کنند، به دلیلی که اندازه‌ی cookieها این روش‌ها به طور چشمگیری در حال افزایش است، با استفاده از هوست‌های بدون cookie برای تصاویر، کارایی را با کم‌کردن حجم هر درخواست، به سادگی افزایش می‌دهد!

تصویر زیر، ردیابی بسته‌های مبادله‌شده توسط یک وب‌سایت پرطرفدار سوئدی را نشان می‌دهد که منابع را در چندین host name مختلف توزیع کرده‌اند.

![image sharding at expressen.se](https://raw.githubusercontent.com/bagder/http2-explained/master/images/expressen-sharding.jpg)